# 成就系统规则说明

本文件定义等级体系、22个成就与解锁条件、经验值分配、数据采集需求与检测时机。

## 等级系统
- 等级经验需求公式：Exp(level) = 100 × level^1.5（为到达“下一等级”所需经验）
- 总经验按已解锁成就累加；等级按“逐级扣除”的方式计算。

示例（前10级所需经验）
1. Lv1: 100
2. Lv2: 283
3. Lv3: 520
4. Lv4: 800
5. Lv5: 1122
6. Lv6: 1485
7. Lv7: 1888
8. Lv8: 2331
9. Lv9: 2812
10. Lv10: 3331
（以上为四舍五入后的近似值，实际引擎按浮点精确计算。）

## 成就总览（22个，合计经验 1890）
- 蓝色（跳绳数量）
  1) 单次100（20）
  2) 单次1000（60）
  3) 累计1万次（100）
  4) 累计10万次（160）
  5) 无失误500连击（60）
- 绿色（动作质量）
  6) 评分≥6（20）
  7) 评分≥8（40）
  8) 评分≥9.5（80）
  9) 评分满分10（120）
  10) 连续5次8分+（80）
  11) 单次提升2分+（60）
- 橙色（时长里程）
  12) 单次≥5分钟（20）
  13) 单次≥15分钟（40）
  14) 单次≥30分钟（80）
  15) 累计≥100小时（160）
  16) 单周≥5小时（100）
- 紫色（计划达成）
  17) 首次完成（10）
  18) 周计划全勤（100）
  19) 月度满勤（180）
  20) 超额完成150%（100）
  21) 连续达标7天（80）
  22) 连续达标30天（220）

注：星标里程碑为更高经验值的成就（如评分满分10、累计10万次、累计100小时、月度满勤、连续30天等）。

## 解锁条件与计算口径
- 记录结构：
  ```ts
  type AchRecord = {
    ts: number;          // 毫秒时间戳
    count: number;       // 单次跳绳次数
    duration: number;    // 单次时长（秒）
    score10?: number;    // 0-10（优先使用）
    symmetry_score?: number; // 0-100（无score10时折算为/10）
    misses?: number;     // 本次失误次数
  }
  ```
- 跳绳数量：
  - 单次100/1000：max(count) ≥ 阈值
  - 累计1万/10万：sum(count) ≥ 阈值
  - 无失误500连击：存在某次 misses=0 且 count≥500
- 动作质量：
  - 评分≥6/8/9.5/10：max(score10 或 symmetry_score/10) ≥ 阈值
  - 连续5次8分+：按时间排序后，统计连续满足次数
  - 单次提升2分+：相邻两次评分差≥2
- 时长里程：
  - 单次≥5/15/30分钟：max(duration) ≥ 阈值（300/900/1800秒）
  - 累计≥100小时：sum(duration) ≥ 360000秒
  - 单周≥5小时：最近7天累计时长 ≥ 18000秒
- 计划达成：
  - 首次完成：存在记录
  - 周计划全勤：最近7天均有记录
  - 月度满勤：任意存在连续30天有记录
  - 超额完成150%：最近7天累计时长 ≥ 1.5 × targetWeeklyHours（默认5h）
  - 连续达标7/30天：任意存在连续7/30天有记录

## 进度显示（progress）
- 对每个成就计算 0~1 的进度值，用于前端进度条与“距离达成”的视觉反馈。
- 例：累计1万次 progress = totalCount / 10000；评分满分10 progress = maxScore / 10。

## 数据采集与检测时机
- 采集自“分析页”写入的 jump_records（localStorage），字段同上。
- 检测时机：
  - 视频分析完成并写入记录后触发更新。
  - 数据页/成就页加载时同步计算与刷新。
  - 清空记录时重算（显示进度归零）。

## 颜色与图标建议
- 蓝（数量）：Activity / Target / Trophy / Gem / Zap
- 绿（质量）：CheckCircle / Award / Star / Crown / TrendingUp
- 橙（时长）：Clock / Timer / Hourglass / CalendarDays / Flame
- 紫（计划）：CircleCheck / CalendarCheck / BadgeCheck / Sparkles / CheckCheck / ShieldCheck

## 兼容性
- 提供 TypeScript 版本：src/utils/achievementRules.ts
- 提供静态页面 JS 版本：public/utils/achievementRules.js（暴露为 window.AchievementEngine）
